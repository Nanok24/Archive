{"version":3,"mappings":"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","names":["routes","path","component","_review_search_page__WEBPACK_IMPORTED_MODULE_0__","ReviewSearchPageRoutingModule","imports","_angular_router__WEBPACK_IMPORTED_MODULE_3__","exports","ReviewSearchPageModule","_angular_common__WEBPACK_IMPORTED_MODULE_5__","_angular_forms__WEBPACK_IMPORTED_MODULE_6__","_ionic_angular__WEBPACK_IMPORTED_MODULE_7__","_review_search_routing_module__WEBPACK_IMPORTED_MODULE_1__","declarations","_review_search_page__WEBPACK_IMPORTED_MODULE_2__","_pipes_filter_pipe__WEBPACK_IMPORTED_MODULE_0__","ReviewSearchPage","afs","afAuth","angularFirestore","user","JSON","parse","localStorage","getItem","collection","snapshotChanges","pipe","booksShelves","map","t","Object","id","payload","doc","data","filter","userId","uid","books","unfilteredBooks","x","includes","bookShelfId","subscribe","reviews","unfilteredReviews","bookId","_services_firestore_service__WEBPACK_IMPORTED_MODULE_2__","_angular_fire_auth__WEBPACK_IMPORTED_MODULE_4__","_angular_fire_firestore__WEBPACK_IMPORTED_MODULE_5__","selector","template","FirestoreService","afStore","onAuthStateChanged","currentUser","book","add","authors","cover","isbn","number_of_pages","publish_date","publishers","title","createdAt","_angular_fire_auth__WEBPACK_IMPORTED_MODULE_0__","_angular_fire_firestore__WEBPACK_IMPORTED_MODULE_1__","providedIn","__webpack_exports__"],"sources":["webpack:///src/app/pages/review-search/review-search-routing.module.ts","webpack:///src/app/pages/review-search/review-search.module.ts","webpack:///src/app/pages/review-search/review-search.page.ts","webpack:///src/app/services/firestore.service.ts","webpack:///src/app/pages/review-search/review-search.page.html"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ReviewSearchPage } from './review-search.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ReviewSearchPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ReviewSearchPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\nimport { FilterPipe } from '../../pipes/filter.pipe';\n\nimport { ReviewSearchPageRoutingModule } from './review-search-routing.module';\n\nimport { ReviewSearchPage } from './review-search.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ReviewSearchPageRoutingModule\n  ],\n  declarations: [ReviewSearchPage, FilterPipe]\n})\nexport class ReviewSearchPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { mergeMap } from 'rxjs/operators';\nimport { Book, Bookshelf, FirestoreService } from '../../services/firestore.service';\nimport { User } from '../../shared/auth';\nimport { Review } from '../review/review.page';\n\n@Component({\n  selector: 'app-review-search',\n  templateUrl: './review-search.page.html',\n  styleUrls: ['./review-search.page.scss']\n})\nexport class ReviewSearchPage implements OnInit {\n  public booksShelves: Bookshelf[];\n  public books: Book[];\n  public reviews: Review[];\n  public searchTerm: string;\n\n  constructor(\n    public afs: FirestoreService,\n    public afAuth: AngularFireAuth,\n    private angularFirestore: AngularFirestore\n  ) {\n  }\n\n  public ngOnInit(): void {\n  }\n\n  ionViewWillEnter() {\n    const user = JSON.parse(localStorage.getItem('user')) as User;\n\n    if(user) {\n      this.angularFirestore.collection('bookshelfs').snapshotChanges().pipe(\n        mergeMap((booksShelves) => {\n          this.booksShelves = booksShelves\n            .map((t) => ({\n              id: t.payload.doc.id,\n              ...t.payload.doc.data() as Bookshelf\n            }))\n            .filter(t => t.userId === user.uid);\n\n          return this.angularFirestore.collection('books').snapshotChanges();\n        }),\n        mergeMap((books) => {\n          const unfilteredBooks = books\n            .map((t) => ({\n              id: t.payload.doc.id,\n              ...t.payload.doc.data() as Book\n            }));\n          this.books = unfilteredBooks.filter(t => this.booksShelves.map(x => x.id).includes(t.bookShelfId));\n\n          return this.angularFirestore.collection('stars').snapshotChanges();\n        })\n      ).subscribe((reviews) => {\n        const unfilteredReviews = reviews\n          .map((t) => ({\n            id: t.payload.doc.id,\n            ...t.payload.doc.data() as Review\n          }));\n        this.reviews = unfilteredReviews.filter(t => this.books.map(x => x.id).includes((t as any).bookId));\n      });\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport {\n  AngularFirestore,\n  AngularFirestoreDocument,\n  AngularFirestoreCollection,\n} from '@angular/fire/firestore';\nimport firebase from 'firebase/app';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport interface Users {\n  uid: string;\n  displayName: string;\n}\n\nexport interface Bookshelf {\n  id: string;\n  userId: string;\n  name: string;\n}\n\nexport interface Book {\n  id?: string;\n  authors?: string;\n  cover?: string;\n  isbn?: string;\n  number_of_pages?: string;\n  publish_date?: string;\n  publishers?: string;\n  title?: string;\n  bookShelfId: string;\n  createdAt: Date;\n}\n\nexport interface Stars {\n  booksID: string;\n  userID: string;\n  text: string;\n  rating: number;\n  createdAt: firebase.firestore.FieldValue;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class FirestoreService {\n  currentUser: Users = null;\n  currentReview: Stars = null;\n  usersCollection: AngularFirestoreCollection<Users>;\n  users: Observable<Users[]>;\n\n  constructor(\n    public afAuth: AngularFireAuth,\n    public afStore: AngularFirestore\n  ) {\n    this.afAuth.onAuthStateChanged((user) => {\n      this.currentUser = user;\n    });\n  }\n\n  // getBooks() {\n  //   this.afStore\n  //     .collection('books')\n  //     .get()\n  //     .forEach((el) => {\n  //       console.log(el);\n  //     });\n  // }\n\n  // Asta functioneaza, daca tu ai alta modalitate, poti sa o modifici schimbi\n  addBook(book: Book) {\n    return this.afStore.collection('books').add({\n      authors: book.authors,\n      cover: book.cover,\n      isbn: book.isbn,\n      number_of_pages: book.number_of_pages,\n      publish_date: book.publish_date,\n      publishers: book.publishers,\n      title: book.title,\n      bookShelfId: book.bookShelfId,\n      createdAt: book.createdAt\n    });\n  }\n}\n","export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button></ion-back-button>\\n    </ion-buttons>\\n    <ion-title class=\\\"title-text\\\">Search reviews</ion-title>\\n  </ion-toolbar>\\n  <ion-grid fixed>\\n    <ion-row>\\n      <ion-col\\n        size=\\\"12\\\"\\n        class=\\\"ion-align-items-center ion-justify-content-center\\\"\\n      >\\n        <ion-searchbar\\n          showCancelButton=\\\"never\\\"\\n          placeholder=\\\"Filter by Book Title\\\"\\n          [(ngModel)]=\\\"searchTerm\\\"\\n          animated\\n        ></ion-searchbar>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-header>\\n\\n<ion-content>\\n  <ion-grid class=\\\"ion-align-items-center ion-justify-content-center\\\">\\n    <ion-row class=\\\"ion-justify-content-center\\\">\\n      <!-- tot ce e in ion-col e template-ul pentru afisarea recenziilor -->\\n      <ion-col\\n        size=\\\"12\\\"\\n        size-md=\\\"6\\\"\\n        size-lg=\\\"4\\\"\\n        style=\\\"width: 390px\\\"\\n        *ngFor=\\\"let review of reviews| filter: searchTerm\\\"\\n      >\\n        <ion-card>\\n          <ion-card-header>\\n            <ion-item lines=\\\"none\\\">\\n              <ion-label class=\\\"card-title ion-text-wrap\\\"\\n                >{{review.title}}</ion-label\\n              >\\n            </ion-item>\\n            <ion-card-subtitle>{{review.bookAuthors}}</ion-card-subtitle>\\n          </ion-card-header>\\n          <ion-card-content\\n            class=\\\"\\n              ion-text-center ion-justify-content-between ion-align-items-center\\n            \\\"\\n          >\\n            <div\\n              style=\\\"width: 100px; height: 250px\\\"\\n              class=\\\"ion-float-left ion-align-items-center\\\"\\n            >\\n              <ion-img\\n                class=\\\"ion-align-items-center\\\"\\n                src=\\\"{{review.cover}}\\\"\\n                style=\\\"\\n                  width: 100px;\\n                  height: 250px;\\n                  margin-bottom: 20%;\\n                  display: inline-block;\\n                \\\"\\n              ></ion-img>\\n            </div>\\n            <ion-list lines=\\\"none\\\">\\n              <ion-item class=\\\"review-text\\\"> {{review.text}} </ion-item>\\n              <ion-item>\\n                <ion-label> {{review.rating}}</ion-label>\\n              </ion-item>\\n            </ion-list>\\n          </ion-card-content>\\n        </ion-card>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\";"]}